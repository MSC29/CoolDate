use chrono::{DateTime, Utc};
use entities::anniversary::Anniversary;

use crate::date_service::DateService;

mod date_service;
mod entities;

const FUN_SECONDS: [u64; 23] = [
    1234567890,
    9876543210,
    10000000,
    100000000,
    1000000000,
    10000000000,
    100000000000,
    1000000000000,
    10000000000000,
    100000000000000,
    1000000000000000,
    11111111,
    111111111,
    1111111111,
    11111111111,
    111111111111,
    1111111111111,
    11111111111111,
    111111111111111,
    1111111111111111,
    7777777,
    88888888,
    999999999,
];

const FUN_DAYS: [u64; 49] = [
    42,
    314,
    12345,
    123456,
    1234567,
    12345678,
    123456789,
    9876543210,
    876543210,
    76543210,
    6543210,
    543210,
    100,
    1000,
    10000,
    100000,
    1000000,
    10000000,
    100000000,
    1000000000,
    10000000000,
    100000000000,
    1000000000000,
    10000000000000,
    100000000000000,
    1000000000000000,
    111,
    1111,
    11111,
    111111,
    1111111,
    11111111,
    111111111,
    1111111111,
    11111111111,
    111111111111,
    1111111111111,
    11111111111111,
    111111111111111,
    1111111111111111,
    333,
    4444,
    55555,
    666,
    666666,
    777,
    7777777,
    88888888,
    999999999,
];

const FUN_WEEKS: [u64; 49] = [
    42,
    314,
    12345,
    123456,
    1234567,
    12345678,
    123456789,
    9876543210,
    876543210,
    76543210,
    6543210,
    543210,
    100,
    1000,
    10000,
    100000,
    1000000,
    10000000,
    100000000,
    1000000000,
    10000000000,
    100000000000,
    1000000000000,
    10000000000000,
    100000000000000,
    1000000000000000,
    111,
    1111,
    11111,
    111111,
    1111111,
    11111111,
    111111111,
    1111111111,
    11111111111,
    111111111111,
    1111111111111,
    11111111111111,
    111111111111111,
    1111111111111111,
    333,
    4444,
    55555,
    666,
    666666,
    777,
    7777777,
    88888888,
    999999999,
];

pub fn find_anniversaries_future(date_str: &str) -> Vec<Anniversary> {
    println!("find_anniversaries_future");
    let now: DateTime<Utc> = Utc::now();
    let date_service = DateService {
        now,
        fun_seconds: FUN_SECONDS.to_vec(),
        fun_days: FUN_DAYS.to_vec(),
        fun_weeks: FUN_WEEKS.to_vec(),
    };

    let date = DateTime::parse_from_rfc3339(date_str);
    match date {
        Ok(d) => date_service.find_anniversaries_from_date(d.with_timezone(&Utc), Some(false)),
        Err(e) => panic!("error converting date: {}", e),
    }
}
